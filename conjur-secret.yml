variables:
  CONJUR_APPLIANCE_URL: "https://conjur.example.com"
  CONJUR_ACCOUNT: "changeme"
  CONJUR_JWT_SERVICE_ID: "gitlab"
  CONJUR_SECRET_VARIABLE_NAME: "ci/gitlab/secret"
<<<<<<< HEAD
  GITLAB_CI_JWT: "jwt"
=======
>>>>>>> 5eb5cb1 (Initial commit)
  SECRET_VARIABLE_NAME: "secret"

conjur:
  script:
<<<<<<< HEAD
    - export SESSION_TOKEN=$(curl -X POST $CONJUR_APPLIANCE_URL/authn-jwt/$CONJUR_JWT_SERVICE_ID/$CONJUR_ACCOUNT/authenticate -H "Content-Type:application/x-www-form-urlencoded" -H "Accept-Encoding:base64" --data-urlencode "jwt=$GITLAB_CI_JWT")
    - export $SECRET_VARIABLE_NAME=$(curl -v -H "Authorization:Token token=\"${SESSION_TOKEN}\"" $CONJUR_APPLIANCE_URL/secrets/$CONJUR_ACCOUNT/variable/$CONJUR_SECRET_VARIABLE_NAME)
    - env
    - unset SESSION_TOKEN
=======
    - SESSION_TOKEN=$(curl -X POST $CONJUR_APPLIANCE_URL/authn-jwt/$CONJUR_JWT_SERVICE_ID/$CONJUR_ACCOUNT -H "Content-Type:application/x-www-form-urlencoded" -H "Accept-Encoding:base64" --data-urlencode "jwt=${CI_JOB_JWT}")
    - export $SECRET_VARIABLE_NAME=$(curl -v -H "Authorization:Token token=\"${SESSION_TOKEN}\"" $CONJUR_APPLIANCE_URL/secrets/$CONJUR_ACCOUNT/variable/$CONJUR_SECRET_NAME)
    - SESSION_TOKEN=""
>>>>>>> 5eb5cb1 (Initial commit)
